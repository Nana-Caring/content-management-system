@page "/Users/Details/{id:int}"
@model CMS.Web.Pages.Users.DetailsModel
@{
    ViewData["Title"] = $"User Profile - {Model.User?.FullName ?? "User Details"}";
}

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        @Model.ErrorMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (Model.User == null)
{
    <div class="text-center py-5">
        <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">User not found</h4>
        <p class="text-muted">The requested user could not be loaded.</p>
        <a href="/Users" class="btn btn-primary">
            <i class="fas fa-arrow-left me-2"></i>Back to Users
        </a>
    </div>
}
else
{
    <style>
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 600;
            color: white;
        }

        .info-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
        }

        .info-card h5 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .role-badge {
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }

        .role-admin { background: #dc354550; color: #dc3545; }
        .role-user { background: #0d6efd50; color: #0d6efd; }
        .role-funder { background: #19875450; color: #198754; }
        .role-dependent { background: #0dcaf050; color: #0dcaf0; }
    </style>

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="row align-items-center">
            <div class="col-auto">
                <div class="profile-avatar">
                    @(Model.User.FirstName?.Substring(0, 1)?.ToUpper())@(Model.User.Surname?.Substring(0, 1)?.ToUpper())
                </div>
            </div>
            <div class="col">
                <h2 class="mb-1">@Model.User.FullName</h2>
                <p class="mb-2 opacity-75">@Model.User.Email</p>
                <span class="role-badge role-@Model.User.Role?.ToLower()">
                    @Model.User.Role
                </span>
            </div>
            <div class="col-auto">
                <a href="/Users" class="btn btn-light">
                    <i class="fas fa-arrow-left me-2"></i>Back to Users
                </a>
            </div>
        </div>
    </div>

    <!-- User Information Cards -->
    <div class="row">
        <!-- Personal Information -->
        <div class="col-md-6">
            <div class="info-card">
                <h5><i class="bi bi-person-fill text-primary"></i> Personal Information</h5>
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <strong>First Name:</strong><br>
                        <span class="text-muted">@(Model.User.FirstName ?? "Not provided")</span>
                    </div>
                    <div class="col-sm-6 mb-2">
                        <strong>Middle Name:</strong><br>
                        <span class="text-muted">@(Model.User.MiddleName ?? "Not provided")</span>
                    </div>
                    <div class="col-sm-6 mb-2">
                        <strong>Surname:</strong><br>
                        <span class="text-muted">@(Model.User.Surname ?? "Not provided")</span>
                    </div>
                    <div class="col-sm-6 mb-2">
                        <strong>ID Number:</strong><br>
                        <span class="text-muted">@(Model.User.IdNumber ?? "Not provided")</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Information -->
        <div class="col-md-6">
            <div class="info-card">
                <h5><i class="bi bi-telephone-fill text-success"></i> Contact Information</h5>
                <div class="mb-2">
                    <strong>Email:</strong><br>
                    <span class="text-muted">@(Model.User.Email ?? "Not provided")</span>
                </div>
                <div class="mb-2">
                    <strong>Phone Number:</strong><br>
                    <span class="text-muted">@(Model.User.PhoneNumber ?? "Not provided")</span>
                </div>
                <div class="mb-2">
                    <strong>Role:</strong><br>
                    <span class="text-muted">@(Model.User.Role ?? "Not provided")</span>
                </div>
                <div>
                    <strong>Relation:</strong><br>
                    <span class="text-muted">@(Model.User.Relation ?? "Not provided")</span>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Postal Address -->
        <div class="col-md-6">
            <div class="info-card">
                <h5><i class="bi bi-mailbox text-info"></i> Postal Address</h5>
                <div class="mb-2">
                    <strong>Address Line 1:</strong><br>
                    <span class="text-muted">@(Model.User.PostalAddressLine1 ?? "Not provided")</span>
                </div>
                @if (!string.IsNullOrEmpty(Model.User.PostalAddressLine2))
                {
                    <div class="mb-2">
                        <strong>Address Line 2:</strong><br>
                        <span class="text-muted">@Model.User.PostalAddressLine2</span>
                    </div>
                }
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <strong>City:</strong><br>
                        <span class="text-muted">@(Model.User.PostalCity ?? "Not provided")</span>
                    </div>
                    <div class="col-sm-6 mb-2">
                        <strong>Province:</strong><br>
                        <span class="text-muted">@(Model.User.PostalProvince ?? "Not provided")</span>
                    </div>
                </div>
                <div>
                    <strong>Postal Code:</strong><br>
                    <span class="text-muted">@(Model.User.PostalCode ?? "Not provided")</span>
                </div>
            </div>
        </div>

        <!-- Home Address -->
        <div class="col-md-6">
            <div class="info-card">
                <h5><i class="bi bi-house-fill text-warning"></i> Home Address</h5>
                <div class="mb-2">
                    <strong>Address Line 1:</strong><br>
                    <span class="text-muted">@(Model.User.HomeAddressLine1 ?? "Not provided")</span>
                </div>
                @if (!string.IsNullOrEmpty(Model.User.HomeAddressLine2))
                {
                    <div class="mb-2">
                        <strong>Address Line 2:</strong><br>
                        <span class="text-muted">@Model.User.HomeAddressLine2</span>
                    </div>
                }
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <strong>City:</strong><br>
                        <span class="text-muted">@(Model.User.HomeCity ?? "Not provided")</span>
                    </div>
                    <div class="col-sm-6 mb-2">
                        <strong>Province:</strong><br>
                        <span class="text-muted">@(Model.User.HomeProvince ?? "Not provided")</span>
                    </div>
                </div>
                <div>
                    <strong>Postal Code:</strong><br>
                    <span class="text-muted">@(Model.User.HomeCode ?? "Not provided")</span>
                </div>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="row">
        <div class="col-12">
            <div class="info-card">
                <h5><i class="bi bi-gear-fill text-secondary"></i> System Information</h5>
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <strong>User ID:</strong><br>
                        <span class="text-muted">@Model.User.Id</span>
                    </div>
                    <div class="col-md-3 mb-2">
                        <strong>Created:</strong><br>
                        <span class="text-muted">@Model.User.CreatedAt.ToString("yyyy-MM-dd HH:mm")</span>
                    </div>
                    <div class="col-md-3 mb-2">
                        <strong>Last Updated:</strong><br>
                        <span class="text-muted">@Model.User.UpdatedAt.ToString("yyyy-MM-dd HH:mm")</span>
                    </div>
                    <div class="col-md-3 mb-2">
                        <strong>Status:</strong><br>
                        <span class="badge bg-success">Active</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Information -->
    @if (Model.User.Accounts?.Any() == true)
    {
        <div class="info-card">
            <h5><i class="bi bi-wallet2 text-primary"></i> Associated Accounts</h5>
            <div class="table-responsive">
                <table class="table table-sm mb-0">
                    <thead>
                        <tr>
                            <th>Account Number</th>
                            <th>Balance</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var account in Model.User.Accounts)
                        {
                            <tr>
                                <td><code>@account.AccountNumber</code></td>
                                <td>R @account.Balance.ToString("N2")</td>
                                <td>
                                    <span class="badge bg-success">Active</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
}
